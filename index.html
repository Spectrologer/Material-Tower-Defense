<!-- This is the main HTML file for the game. -->

<!DOCTYPE html>

<html lang="en">
<head>
<!-- Basic setup for the webpage -->
<meta charset="UTF-8">
<!-- This makes sure the game looks good on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Iconic Tower Defense</title>

<!-- This script brings in TailwindCSS for easy styling -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- These lines are for loading custom fonts from Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<!-- This is the pixel-art style font used for the game's text -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<!-- These are for the icons used throughout the game (like for towers and buttons) -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<!-- Adding Font Awesome for the new Cat Tower icon -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<!-- This is where we define the game's custom styles -->
<style>
    /* General look and feel for the whole page */
    body, html {
        font-family: 'Press Start 2P', cursive; /* Sets the pixel font */
        background-color: #1a1a1a; /* Dark background */
        color: #e0e0e0; /* Light text color */
        overflow: hidden; /* Prevents scrollbars */
        height: 100%;
        /* This is the new rule to prevent text highlighting */
        user-select: none;
        -webkit-user-select: none; /* For WebKit browsers */
        -moz-user-select: none; /* For Mozilla browsers */
        -ms-user-select: none; /* For Internet Explorer/Edge */
    }
    /* New rule to change cursor when dragging */
    body.is-dragging {
        cursor: grabbing !important;
    }
    /* Style for the game's drawing area (the canvas) */
    canvas {
        background-color: #2c2c2c; /* Dark gray for the game area */
        box-shadow: 0 0 20px rgba(0, 255, 136, 0.2); /* A nice green glow */
        border: 2px solid rgba(0, 255, 136, 0.4);
        position: absolute;
        cursor: grab; /* Default cursor for grabbing on the canvas */
    }
    /* Style for all the UI panels (stats, towers, game over screen) */
    .game-ui-panel, .game-over-modal, .game-stats-panel {
        background-color: rgba(26, 26, 26, 0.8); /* See-through dark background */
        backdrop-filter: blur(5px); /* Blurs what's behind the panel */
        border: 2px solid rgba(0, 255, 136, 0.4); /* Green border */
    }
    /* Style for the clickable buttons */
    .pixel-button {
        background-color: #3e3e3e;
        color: #00ff88;
        border: 2px solid #00ff88;
        padding: 10px 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.2s ease;
        box-shadow: 0 4px 0 #00aa5b; /* Gives it a 3D, pressable look */
        cursor: pointer;
    }
    /* What buttons look like when you hover over them */
    .pixel-button:hover:not(:disabled) {
        background-color: #4f4f4f;
        transform: translateY(-2px); /* Lifts the button up a bit */
        box-shadow: 0 6px 0 #00aa5b;
    }
    /* What buttons look like when you're clicking them */
    .pixel-button:active:not(:disabled) {
        transform: translateY(2px); /* Pushes the button down */
        box-shadow: 0 2px 0 #00aa5b;
    }
    /* Style for buttons you can't afford or use yet */
    .pixel-button:disabled {
        background-color: #2a2a2a;
        color: #555;
        border-color: #555;
        box-shadow: 0 4px 0 #333;
        cursor: not-allowed;
    }
    /* Highlights the tower button you've selected to place */
    .tower-button.selected, #cloud-inventory-slots .pixel-button.selected {
        background-color: #00ff88;
        color: #1a1a1a;
        box-shadow: 0 4px 0 #00aa5b;
        transform: translateY(-2px);
    }
    
    /* FIX: Explicitly set font-family for icon classes to override global font and fix tooltips. */
    .material-icons {
        font-family: 'Material Icons';
    }
    .material-symbols-outlined {
      font-family: 'Material Symbols Outlined';
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 48;
    }
    .fa-solid {
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
    }

    /* Custom styles for the new debug button */
    #infinite-gold {
        background-color: #dc2626;
        border-color: #dc2626;
        color: #fde047;
        box-shadow: 0 4px 0 #991b1b;
    }
    #infinite-gold:hover:not(:disabled) {
        background-color: #ef4444;
        box-shadow: 6px 0 #991b1b;
    }
    #infinite-gold:active:not(:disabled) {
        transform: translateY(2px);
        box-shadow: 2px 0 #991b1b;
    }
    /* Custom tooltip styling */
    .tooltip {
        position: absolute;
        background-color: rgba(0, 0, 0, 0.85);
        color: #00ff88;
        border: 2px solid #00ff88;
        padding: 8px;
        font-size: 14px;
        font-family: 'Press Start 2P', cursive;
        text-align: center;
        white-space: nowrap;
        z-index: 10;
        pointer-events: none; /* Prevents the tooltip from blocking mouse events */
    }
    .bottom-controls {
        background-color: rgba(26, 26, 26, 0.4);
        backdrop-filter: blur(5px);
        border: 2px solid rgba(0, 255, 136, 0.2);
        padding: 1rem;
        display: flex;
        gap: 0.5rem;
        justify-content: space-between;
    }
</style>

</head>
<body class="flex items-center justify-center">

<!-- This is the main container for the entire game interface. -->
<div class="flex flex-col h-full w-full max-w-md mx-auto p-2 sm:p-4 gap-2">
    
    <!-- This is the stats bar at the top (Lives, Gold, Wave) -->
    <div class="game-stats-panel py-1 px-2 flex-shrink-0 relative">
        <h1 class="text-sm text-center text-green-400">ICONIC TD</h1>
        <div class="flex justify-between items-center text-xs md:text-sm">
            <div class="flex flex-1 justify-center items-center gap-x-4 md:gap-x-6">
                <p class="flex items-center gap-1"><span class="material-symbols-outlined text-red-500 text-base md:text-lg">favorite</span> <span id="lives" class="text-red-500">20</span></p>
                <p class="flex items-center gap-1"><span class="material-symbols-outlined text-yellow-400 text-base md:text-lg">paid</span> <span id="gold" class="text-yellow-400">100</span></p>
                <p class="flex items-center gap-1 text-cyan-400">WAVE: <span id="wave" class="text-cyan-400">0</span></p>
            </div>
            <!-- Container for the sound toggle button -->
            <button id="sound-toggle-btn" class="text-xs px-2 py-1">
                <span id="sound-icon" class="material-icons">volume_up</span>
            </button>
        </div>
    </div>

    <!-- This container holds the actual game canvas AND the new cloud inventory -->
    <div class="flex-grow relative w-full min-h-0 flex gap-2">
        <div id="canvas-container" class="flex-grow relative h-full min-h-0">
            <!-- The canvas is now draggable to enable dragging towers from the game grid -->
            <canvas id="gameCanvas" draggable="true"></canvas>
        </div>
        <!-- Cloud Inventory Panel, this is a drop target for towers from the canvas -->
        <div id="cloud-inventory-panel" class="hidden game-ui-panel w-[72px] flex-shrink-0 flex flex-col items-center p-1 gap-2 overflow-y-auto">
            <h3 class="text-xs text-green-400 -mb-1">CLOUD</h3>
            <div id="cloud-inventory-slots" class="flex flex-col gap-2 w-full items-center">
                <!-- Inventoried towers will be added here -->
            </div>
        </div>
    </div>
    
    <!-- This is the control panel at the bottom of the screen -->
    <div class="game-ui-panel p-4 w-full flex-shrink-0 flex flex-col gap-4">
        
        <div id="tower-buttons-group">
            <h2 id="towers-title" class="text-xl text-green-400">TOWERS</h2>
            <!-- Buttons to buy the different towers -->
            <div id="tower-buttons" class="grid grid-cols-3 gap-2 mt-2">
                <button id="buy-pin" class="pixel-button tower-button text-xs sm:text-sm">PIN (25G)</button>
                <button id="buy-castle" class="pixel-button tower-button text-xs sm:text-sm">CASTLE (75G)</button>
                <button id="buy-support" class="pixel-button tower-button text-xs sm:text-sm">SUPPORT (60G)</button>
            </div>
        </div>
        
        <!-- This panel appears when you select a tower you've already placed -->
        <div id="sell-panel" class="hidden flex flex-col gap-2">
            <hr class="border-gray-600"/>
            <h3 class="text-lg text-center text-green-400">SELECTED</h3>
            <h4 id="selected-tower-info" class="text-center text-yellow-400 text-sm h-4 mb-2"></h4>
            <!-- Shows the stats of the selected tower -->
            <div id="tower-stats-panel" class="flex flex-wrap justify-center gap-x-4 gap-y-1 text-xs sm:text-sm mb-2">
                <p id="stat-damage-p" class="flex items-center gap-1"><span class="material-icons text-base align-bottom" title="Damage">bolt</span> Dmg: <span id="stat-damage">0</span></p>
                <p id="stat-range-p" class="flex items-center gap-1"><span class="material-icons text-base align-bottom" title="Range">radar</span> Rng: <span id="stat-range">0</span></p>
                <p id="stat-speed-p" class="flex items-center gap-1"><span class="material-icons text-base align-bottom" title="Attack Speed">speed</span> Spd: <span id="stat-speed">0</span>/s</p>
                <p id="stat-splash-p" class="flex items-center gap-1"><span class="material-icons text-base align-bottom" title="Splash Radius">bubble_chart</span> Spl: <span id="stat-splash">0</span></p>
                <p id="stat-projectiles-p" class="flex items-center gap-1"><span class="material-symbols-outlined text-base align-bottom" title="Projectiles">multiple_stop</span> Proj: <span id="stat-projectiles">0</span></p>
                <p id="stat-boost-p" class="flex items-center gap-1"><span class="material-icons text-base align-bottom" title="Boost">electric_bolt</span> Bst: <span id="stat-boost">0</span>%</p>
                <p id="stat-slow-p" class="flex items-center gap-1"><span class="material-symbols-outlined text-base align-bottom" title="Slow">hourglass_empty</span> Slw: <span id="stat-slow">0</span>%</p>
                <p id="stat-gold-p" class="hidden flex items-center gap-1"><span class="material-icons text-base align-bottom" title="Gold Bonus">savings</span> Gld: +<span id="stat-gold">0</span>%</p>
                <p id="stat-burn-p" class="flex items-center gap-1"><span class="material-symbols-outlined text-base align-bottom" title="Burn Damage">local_fire_department</span> Brn: <span id="stat-burn">0/s</span></p>
                <p id="stat-special-p" class="flex items-center gap-1 col-span-full justify-center"><span class="material-symbols-outlined text-base align-bottom" title="Special Ability">star</span><span id="stat-special">None</span></p>
            </div>
            <button id="toggle-mode" class="pixel-button bg-purple-800 text-yellow-300 border-yellow-300 hidden">MODE: </button>
            <div id="selected-tower-actions" class="grid grid-cols-2 gap-2">
                 <!-- Button to sell the selected tower -->
                <button id="sell-tower-btn" class="pixel-button bg-red-700 text-yellow-300 border-yellow-400 shadow-[0_4px_0_#9a3412] text-sm py-2">SELL</button>
                <!-- Button to move the selected tower to the cloud -->
                <button id="move-to-cloud-btn" class="pixel-button bg-cyan-700 text-white border-cyan-500 shadow-[0_4px_0_#0e7490] text-sm py-2 hidden items-center justify-center gap-1 sm:flex">
                    <span class="material-symbols-outlined !text-base">cloud_upload</span>
                    <span class="hidden sm:inline">CLOUD</span>
                </button>
            </div>
        </div>

        <!-- Buttons for starting the next wave, changing game speed, and the new debug button -->
        <div id="game-controls" class="flex gap-2 mt-auto">
            <button id="start-wave" class="pixel-button flex-auto">START WAVE</button>
            <button id="speed-toggle" class="pixel-button flex-auto">x1</button>
            <button id="cloud-button" class="pixel-button flex-auto flex items-center justify-center !p-2 text-xs">
                <span id="cloud-icon" class="material-symbols-outlined !text-lg">cloud</span>
                <span id="cloud-text" class="ml-1">(100G)</span>
            </button>
        </div>
    </div>
</div>

<!-- This is the "Game Over" screen. It's hidden until you lose. -->
<div id="game-over-modal" class="hidden absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center z-20">
    <div class="game-over-modal text-center p-8">
        <h2 id="game-over-title" class="text-4xl mb-4">GAME OVER</h2>
        <p id="game-over-message" class="text-xl mb-6">You survived 0 waves!</p>
        <button id="restart-game" class="pixel-button text-2xl">RESTART</button>
    </div>
</div>

<!-- New Merge Confirmation Modal -->
<div id="merge-confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-30">
    <div class="game-ui-panel text-center p-6 w-11/12 max-w-sm">
        <h3 class="text-lg sm:text-xl text-green-400 mb-4">CONFIRM MERGE</h3>
        <div class="flex items-center justify-center gap-4 text-white text-sm sm:text-base">
            <div class="flex flex-col items-center">
                <div id="merge-from-tower-icon-container" class="w-12 h-12 flex items-center justify-center text-3xl"></div>
                <span id="merge-from-tower-name" class="mt-1"></span>
            </div>
            <span class="material-symbols-outlined text-2xl text-yellow-400">add</span>
            <div class="flex flex-col items-center">
                <div id="merge-to-tower-icon-container" class="w-12 h-12 flex items-center justify-center text-3xl"></div>
                <span id="merge-to-tower-name" class="mt-1"></span>
            </div>
            <span class="material-symbols-outlined text-2xl text-green-400">arrow_right_alt</span>
            <div class="flex flex-col items-center">
                <div id="merge-result-tower-icon-container" class="w-12 h-12 flex items-center justify-center text-3xl"></div>
                <span id="merge-result-tower-name" class="mt-1"></span>
            </div>
        </div>
        <div id="merge-cost-info" class="text-center text-yellow-400 text-sm my-4"></div>
        <div class="grid grid-cols-2 gap-4 mt-6">
            <button id="confirm-merge-btn" class="pixel-button bg-green-700 text-white border-green-500 shadow-[0_4px_0_#15803d]">CONFIRM</button>
            <button id="cancel-merge-btn" class="pixel-button bg-red-700 text-white border-red-500 shadow-[0_4px_0_#b91c1c]">CANCEL</button>
        </div>
    </div>
</div>

<!-- This is the most important part! It loads the JavaScript file that runs all the game logic. -->
<script type="module" src="js/main.js"></script>

</body>
</html>